<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="navbar">
        <div class="navMenu" id="navMenu">
            <p>@moeday</p>
        </div>
        <div class="navLinkGroup">
            <a class="navLink" href="#">Home</a>
            <a class="navLink" href="#">Tag</a>
            <a class="navLink" href="#">About</a>
        </div>
    </div>
    <div class="slogan">「爱可以治愈我的心，欢迎倾听我的心声」</div>
    <div class="content"></div>
</body>

<script>
    let httpRequest;

    function makeRequest() {
        httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            console.log("放弃了 :( 不能创建 XMLHTTP 实例");
            return false;
        }
        httpRequest.onreadystatechange = displayCards;
        httpRequest.open("GET", "index.json");
        httpRequest.send();
    }

    function displayCards() {
        try {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    let json = httpRequest.responseText;
                    createDivsByJson(json);//创建文章列表DIV
                } else {
                    console.log("请求遇到了问题。");
                }
            }
        } catch (e) {
            console.log(`遇到了 exception：${e.description}`);
        }
    }

    //通过JSON创建文章DIV
    function createDivsByJson(json) {
        let array = JSON.parse(json);
        for (const item of array) {
            //创建一堆DIV
            let card = createDivWithClass('card');
            let title = createDivWithClass('title');
            let info = createDivWithClass('info');
            let summary = createDivWithClass('summary');
            let tag = createDivWithClass('tag');
            let countAndDate = createDivWithClass('countAndDate');

            //创建了标题a元素里面插入内容
            let titleLink = createAWithClass('#');
            titleLink.textContent = item.title;

            //创建了内容片段a元素里面插入内容
            let summaryLink = createAWithClass('#');
            let summaryText = marked.parse(item.content).replace(/<[^>]*>/g, ''); //markdown->html->txt
            summaryLink.textContent = summaryText.substring(0, 80).concat(' ...'); //截取80个字符

            // //markdown->html // !
            // let summaryText = marked.parse(item.content); 
            // summaryLink.innerHTML = summaryText;

            //创建了标签a元素里面插入内容
            let tagLink = createAWithClass('#');
            tagLink.textContent = item.tag;

            //每个div插入a元素
            title.appendChild(titleLink);
            summary.appendChild(summaryLink);
            tag.appendChild(tagLink);

            //计数和日期元素插入内容
            // countAndDate.textContent = '字数' + summaryText.length + ' ' + '日期' + item.date;
            countAndDate.textContent = summaryText.length + ' 字';

            //组合card
            card.appendChild(title)
            card.appendChild(summary)
            info.appendChild(tag)
            info.appendChild(countAndDate)
            card.appendChild(info)

            //把所有的card都插入content里面
            document.body.getElementsByClassName('content')[0].appendChild(card);
        }
    }

    function createDivWithClass(className) {
        const div = document.createElement("div");
        div.setAttribute('class', className);
        return div;
    }

    function createAWithClass(href) {
        const a = document.createElement('a');
        a.setAttribute('href', href);
        return a;
    }

    makeRequest();//开始请求

    document.querySelector("#navMenu").addEventListener("click", ()=>{
        document.getElementsByClassName('navLinkGroup')[0].classList.toggle("active");
    });

// (() => 'foobar')();
// Returns "foobar"
// (这是一个立即执行函数表达式，可参阅 'IIFE'术语表)
</script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</html>