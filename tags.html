<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tags - moeday's blog</title>
    <link rel="stylesheet" href="./styles/tags.css">
</head>

<body>
    <div class="navbar">
        <div class="navMenu" id="navMenu">
            moeday
        </div>
        <div class="navLinkGroup">
            <a class="navLink" href="./">Home</a>
            <a class="navLink" href="./tags.html">Tag</a>
            <a class="navLink" href="#">About</a>
        </div>
    </div>
    <div class="slogan">
        <img src="./pics/Rin 02_st.ayaka.one.png" alt="空无一人的世界" style="width: 200px;">
    </div>
    <div class="content">
    </div>
</body>

<script>
    let cardTemplate = `
    
    `;

    fetch("links.json")
        .then((response) => response.json())
        .then((urls) => {
            // document.getElementsByClassName("content")[0].innerHTML = cardTemplate.repeat(urls.length);
            let tag = null;
            let tempUrls = urls;
            for (i = 0; i < urls.length; i++) {
                let p = i;
                fetch("posts/" + urls[i])
                    .then((response) => response.text())
                    .then((data) => {
                        const { metadata, text } = metadataParser(data);
                        if (metadata.categories !== tag) {
                            let tagTitle = document.createElement("div");
                            tagTitle.className = "tag-title";
                            tagTitle.id=metadata.categories;
                            tagTitle.textContent = metadata.categories;
                            // console.log(tagTitle);
                            document.getElementsByClassName("content")[0].appendChild(tagTitle);
                        }
                        let tagLink = document.createElement("div");
                        tagLink.className = "tag-link";
                        let tagLinkA = document.createElement("a");
                        tagLinkA.setAttribute("href", "posts/?title=" + tempUrls[p]);
                        tagLinkA.textContent = metadata.title;
                        tagLink.appendChild(tagLinkA);
                        // console.log(tagLink);
                        document.getElementsByClassName("content")[0].appendChild(tagLink);
                        tag = metadata.categories;
                    });
            }
        })

    // 定义一个元数据解析器
    function metadataParser(text) {
        // 用正则表达式匹配元数据
        const regex = /^---\n([\s\S]*?)\n---\n/;
        const match = regex.exec(text);
        // 如果有元数据，返回一个对象，包含元数据和剩余的文本
        if (match) {
            const metadata = {};
            const lines = match[1].split('\n');
            for (const line of lines) {
                const [key, value] = line.split(':');
                metadata[key.trim()] = value.trim();
            }
            return {
                metadata: metadata,
                text: text.slice(match[0].length),
            };
        }
        // 如果没有元数据，返回原始文本
        return {
            text: text,
        };
    };

</script>
<script>
    //navbar
    document.querySelector("#navMenu").addEventListener("click", () => {
        document.getElementsByClassName('navLinkGroup')[0].classList.toggle("active");
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</html>